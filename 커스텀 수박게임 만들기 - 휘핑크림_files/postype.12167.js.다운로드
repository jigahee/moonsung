$(function(){const $body=$("body");const $header=$("#header");const $headerCustom=$("#header-custom");const blogId=$body.attr("data-blog-id");const $appMenuToggler=$("#app-menu-toggler");const $appMenu=$("#app-menu");const $appMenuBackdrop=$("#app-menu-backdrop");$appMenuToggler.on("click",function(){$appMenu.toggle();$appMenuBackdrop.toggle()});$appMenuBackdrop.on("click",function(){$appMenu.hide();$appMenuBackdrop.hide()});const $postBody=$("body[data-post-id]");const $postBodyWrapper=$("#post-body-wrapper");let $postContent=$("#post-content");let cookieDomain=window.location.hostname;let separate=cookieDomain.split('.');if(separate.length>1){separate.shift();cookieDomain="."+separate.join('.')}else{cookieDomain="."+cookieDomain}
const visitKey="visit."+blogId;const expires=new Date();expires.setHours(23,59,59,999);initUI();if($postBody.length>0||$postBodyWrapper.length>0||$postContent.length>0){const postId=$postBody.attr("data-post-id");const postHistoryId=$postBody.attr("data-post-history-id");if(postId!==undefined){initLikeActions(postId);initCommentActions(postId)}
if($postContent.length>0){initPostContent(postId)}else{const mode=parseQueryString()['mode'];let url=`${postypeUrl}/api/post/content/${postId}`;if(mode){url=`${url}?mode=${mode}`}else if(postHistoryId){url=`${url}?post_history_id=${postHistoryId}`}
$.ajax({url:url,type:"get",dataType:"jsonp",success:function(json){$postBodyWrapper.prepend(json.data.html);initPostContent(postId)}})}}else{setTimeout(function(){const visitCookie=Cookies.get(visitKey);if(!visitCookie){let referrer=document.referrer;if(typeof referrer==="undefined"){referrer=""}
$.ajax({url:postypeUrl+"/api/blog/visit",type:"get",dataType:"jsonp",data:"blog_id="+blogId+"&referrer="+referrer,success:function(json){if(json.status==="success"){Cookies.set(visitKey,!0,{expires:expires,path:"/",domain:cookieDomain})}}})}},2000)}
const $btnBackgroundWhite=$("#background-white");const $btnBackgroundBlack=$("#background-black");$btnBackgroundBlack.on("click",function(){setDarkMode(!0)});$btnBackgroundWhite.on("click",function(){setWhiteMode(!0)});function setDarkMode(setCookie){$btnBackgroundWhite.removeClass("active");$btnBackgroundBlack.addClass("active");$body.addClass("dark-mode");if(setCookie){Cookies.set("bgcolormode","black",{expires:365,path:'/',domain:cookieDomain});$.ajax({url:postypeUrl+"/user/setBackgroundColor",type:"get",dataType:"jsonp",data:"bgcolor="+"black",success:function(json){if(json.status==="success"){}}})}}
function setWhiteMode(setCookie){$btnBackgroundWhite.addClass("active");$btnBackgroundBlack.removeClass("active");$body.removeClass("dark-mode");if(setCookie){Cookies.set("bgcolormode","white",{expires:365,path:'/',domain:cookieDomain});$.ajax({url:postypeUrl+"/user/setBackgroundColor",type:"get",dataType:"jsonp",data:"bgcolor="+"white",success:function(json){if(json.status==="success"){}}})}}
let bgColor=Cookies.get("bgcolormode");if(bgColor==="black"){setDarkMode(!1)}else if(bgColor==="white"){setWhiteMode(!1)}else{$.ajax({url:postypeUrl+"/user/getBackgroundColor",type:"get",dataType:"jsonp",success:function(json){if(json.status==="success"){if(json.data==="black"){setDarkMode(!0)}else if(json.data==="white"){setWhiteMode(!0)}}}})}
function inIframe(){try{return window.self!==window.top}catch(e){return!0}}
if(inIframe()){window.addEventListener('message',function(event){if(event.origin.indexOf('postype.com')||event.origin.indexOf('postype.local')||event.origin.indexOf('postype.org')||event.origin.indexOf('postype.net')){if(event.data.request==="init"){disableButtons=!0}else{$("#app-menu-container").hide();const $blog=$("#blog");const $customStyleTag=$("#custom-style-tag");const $mastheadTitle=$("#masthead > .masthead-title");const $blogLogoWrapper=$("#blog-logo-wrapper");if(event.data.blog_header_size==="large"){$blog.addClass("header-size-lg");$blog.removeClass("header-size-md")}else{$blog.addClass("header-size-md");$blog.removeClass("header-size-lg")}
if(event.data.blog_header_align==="left"){$blog.addClass("header-align-left");$blog.removeClass("header-align-center")}else{$blog.addClass("header-align-center");$blog.removeClass("header-align-left")}
if(event.data.blog_header_font_family==="serif"){$blog.addClass("header-serif");$blog.removeClass("header-sans-serif")}else{$blog.addClass("header-sans-serif");$blog.removeClass("header-serif")}
if(event.data.post_list_style==="list"){$blog.addClass("post-list-view");$blog.removeClass("post-grid-view")}else{$blog.addClass("post-grid-view");$blog.removeClass("post-list-view")}
if(event.data.series_list_style==="list"){$blog.addClass("series-list-view");$blog.removeClass("series-grid-view")}else{$blog.addClass("series-grid-view");$blog.removeClass("series-list-view")}
if(event.data.post_tile_size==="small"){$blog.addClass("post-tile-sm");$blog.removeClass("post-tile-md")}else{$blog.addClass("post-tile-md");$blog.removeClass("post-tile-sm")}
if(event.data.blog_header_background_image){$blog.addClass("header-bg-img");$headerCustom.css("background-image","url('"+event.data.blog_header_background_image+"')")}else{$blog.removeClass("header-bg-img");$headerCustom.css("background-image","")}
if(event.data.blog_header_layout==="logo"&&event.data.blog_header_logo){$blog.removeClass("header-title-tagline");$blog.removeClass("header-logo-title-tagline");$blog.addClass("header-logo");$mastheadTitle.find(".masthead-logo").remove();$mastheadTitle.prepend("<div class=\"masthead-logo\"><img alt='' src='"+event.data.blog_header_logo+"' class='blog-header-logo'></div>");$blogLogoWrapper.find("img").remove();$blogLogoWrapper.prepend("<img alt='' class=\"blog-logo\" src=\""+event.data.blog_header_logo+"\">")}else{if(event.data.blog_header_layout==="logo_title_tagline"&&event.data.blog_header_logo){$blog.removeClass("header-title-tagline");$blog.addClass("header-logo-title-tagline");$blog.removeClass("header-logo");$mastheadTitle.find(".masthead-logo").remove();$mastheadTitle.prepend("<div class=\"masthead-logo\"><img alt='' src='"+event.data.blog_header_logo+"' class='blog-header-logo'></div>");$blogLogoWrapper.find("img").remove();$blogLogoWrapper.prepend("<img alt='' class=\"blog-logo\" src=\""+event.data.blog_header_logo+"\">")}else{$blog.addClass("header-title-tagline");$blog.removeClass("header-logo-title-tagline");$blog.removeClass("header-logo");$mastheadTitle.find(".masthead-logo").remove();$blogLogoWrapper.find("img").remove()}}
if(event.data.primary_color&&event.data.color_fill==="on"){$headerCustom.css("background-color",event.data.primary_color);$blog.addClass("header-bg-color")}else{$headerCustom.css("background-color","");$blog.removeClass("header-bg-color")}
if(isDarkColor(event.data.primary_color)&&event.data.color_fill==="on"){$blog.addClass("invert-colors")}else{$blog.removeClass("invert-colors")}
if(event.data.darkmode==="on"){setDarkMode(!1)}else{setWhiteMode(!1)}
const white_mode_primary_color=getWhiteTextColor(event.data.primary_color);const dark_mode_primary_color=getDarkTextColor(event.data.primary_color);const style=":root {--primary-color:"+event.data.primary_color+";--white-mode-primary-color:"+white_mode_primary_color+";--dark-mode-primary-color:"+dark_mode_primary_color+";}";$customStyleTag.text(style)}}else{return!1}});let disableButtons=!1;if(inIframe()){$("#blog").find("a, button").off("click").on("click",function(event){if(disableButtons){const $btn=$(this);if($btn.closest("#gnb-nav").length===0||$btn.attr("id")==="admin-options"){event.preventDefault();alertPostype("테마 편집 화면에서는 동작하지 않습니다.");return!1}}});function isDarkColor(hex){let hsl=hexToHSL(hex);if(hsl.l<=50){return!0}
if(100-hsl.l+hsl.s>=60){return!0}
return!1}
function getWhiteTextColor(hex){let hsl=hexToHSL(hex);if(hsl.l>30){hsl.l=30}
return hslToHex(hsl.h,hsl.s,hsl.l)}
function getDarkTextColor(hex){let hsl=hexToHSL(hex);if(hsl.l<80){hsl.l=80}
return hslToHex(hsl.h,hsl.s,hsl.l)}
function hslToHex(h,s,l){h/=360;s/=100;l/=100;let r,g,b;if(s===0){r=g=b=l}else{function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}
let q=l<0.5?l*(1+s):l+s-l*s;let p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}
function toHex(x){let hex=Math.round(x*255).toString(16);return hex.length===1?'0'+hex:hex}
return"#"+toHex(r)+toHex(g)+toHex(b)}
function hexToHSL(hex){let result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);let r=parseInt(result[1],16);let g=parseInt(result[2],16);let b=parseInt(result[3],16);let rgb=[]
rgb[0]=(r/255);rgb[1]=(g/255);rgb[2]=(b/255);let min=Math.min(rgb[0],rgb[1],rgb[2]);let max=Math.max(rgb[0],rgb[1],rgb[2]);let del_max=max-min;let v=max;let s;let h=0;if(del_max===0){h=0;s=0}else{s=del_max/max;let del_r=(((max-rgb[0])/6)+(del_max/2))/del_max;let del_g=(((max-rgb[1])/6)+(del_max/2))/del_max;let del_b=(((max-rgb[2])/6)+(del_max/2))/del_max;if(rgb[0]===max)h=del_b-del_g;else if(rgb[1]===max)h=(1/3)+del_r-del_b;else if(rgb[2]===max)h=(2/3)+del_g-del_r;if(h<0)h++;if(h>1)h--}
return{h:h*360,s:s*100,l:v*100}}
postObject({request:'reset_style'});postObject({request:"init"});function postObject(obj){parent.postMessage(obj,'*')}}}
const $modalAppLink=$("#modal-app-link");if($modalAppLink.length>0){try{if(!Cookies.get("modalapplink")){$modalAppLink.show();$modalAppLink.on("click","#btn-close-modal-app-link",function(event){event.preventDefault();$modalAppLink.hide();Cookies.set("modalapplink",1,{expires:365,path:'/',domain:cookieDomain});return!1})}}catch(e){}}
function initLikeActions(postId){const $btnLikeUser=$("#btn-like-user");const $likeUser=$("#like-user");const $likeUserList=$("#like-user-list");const $btnMoreLikeUser=$("#btn-more-like-user");let likePage=1;$btnLikeUser.on("click",function(){$likeUserList.empty();$likeUser.modal("show");likePage=1;$.ajax({url:postypeUrl+"/api/like/users/"+postId,type:"get",dataType:"jsonp",data:"&page="+likePage,success:function(json){if(json.status==="success"){$(json.data.items).each(function(i,val){$likeUserList.append(val)});if(json.data.page<json.data.total_pages){$btnMoreLikeUser.show();$btnMoreLikeUser.attr("data-page",parseInt(json.data.page)+1)}else{$btnMoreLikeUser.hide()}}}})});$btnMoreLikeUser.on("click",function(){likePage=$btnMoreLikeUser.attr("data-page");$btnMoreLikeUser.attr("disabled","disabled");$btnMoreLikeUser.text("로딩중");$.ajax({url:postypeUrl+"/api/like/users/"+postId,type:"get",dataType:"jsonp",data:"&page="+likePage,success:function(json){if(json.status==="success"){$(json.data.items).each(function(i,val){$likeUserList.append(val)});if(json.data.page<json.data.total_pages){$btnMoreLikeUser.show();$btnMoreLikeUser.attr("data-page",parseInt(json.data.page)+1)}else{$btnMoreLikeUser.hide()}
$btnMoreLikeUser.removeAttr("disabled");$btnMoreLikeUser.text("더 보기")}}})})}
function initCommentActions(postId){const $commentList=$("#comment-list");let commentPage=1;const $btnMoreComment=$("#btn-more-comment");if($commentList.length>0){let comment_id=0;if(location.hash){comment_id=location.hash.replace("#comment-","")}
$.ajax({url:postypeUrl+"/api/comment/list",type:"get",dataType:"jsonp",data:"post_id="+postId+"&page="+commentPage+"&comment_id="+comment_id,success:function(json){if(json.status==="success"){$(json.data.items).each(function(i,val){$commentList.prepend(val)});if(json.data.page<json.data.total_pages){$btnMoreComment.show();$btnMoreComment.attr("data-page",parseInt(json.data.page)+1)}else{$btnMoreComment.hide()}
if(location.hash){setTimeout(function(){let offTop=$(location.hash).offset().top-$header.height();$(window).scrollTop(offTop)},100)}
const $tooltip=$commentList.find("time[data-toggle='tooltip']");$tooltip.tooltip()}}})}
$btnMoreComment.on("click",function(){getMoreComment()});function getMoreComment(){$btnMoreComment.attr("disabled","disabled");$btnMoreComment.text("로딩중");commentPage=$btnMoreComment.attr("data-page");$.ajax({url:postypeUrl+"/api/comment/list",type:"get",dataType:"jsonp",data:"post_id="+postId+"&page="+commentPage,success:function(json){if(json.status==="success"){$commentList.find(".is-notice").remove();$(json.data.items).each(function(i,val){$commentList.prepend(val)});if(json.data.page<json.data.total_pages){$btnMoreComment.show();$btnMoreComment.attr("data-page",parseInt(json.data.page)+1)}else{$btnMoreComment.hide()}
$btnMoreComment.removeAttr("disabled");$btnMoreComment.text("이전 댓글 보기");let $tooltip=$commentList.find("time[data-toggle='tooltip']");$tooltip.tooltip()}}})}
$commentList.on("click",".btn-open-replies",function(){const $btn=$(this);const $commentItem=$btn.closest(".comment-item");const commentId=$btn.attr("data-comment-id");$.ajax({url:postypeUrl+"/api/comment/replies",type:"get",dataType:"jsonp",data:"comment_id="+commentId,success:function(json){if(json.status==="success"){const $html=$("<div>")
$(json.data.items).each(function(i,val){$html.append(val)});$commentItem.after($html.html());$btn.hide();let $tooltip=$commentList.find("time[data-toggle='tooltip']");$tooltip.tooltip()}}})});const $commentForm=$("#comment-form");const $commentReplyForm=$("#comment-reply-form");const $commentEditForm=$("#comment-edit-form");if($commentForm.length>0){$('#general-comment[value="general"]').on("click",function(){$('#comments .secret-comment-form').css('display','block');$('#comments #supporter-options').css('display','none');$('#comments .image-uploader').css('display','none')});$('#general-comment[value="membership"]').on("click",function(){$('#comments .secret-comment-form').css('display','block');$('#comments #supporter-options').css('display','none');$('#comments .image-uploader').css('display','block')});const $supportComment=$("#support-comment");$supportComment.on("click",function(){$('#comments .secret-comment-form').css('display','none');$('#comments #supporter-options').css('display','block');$('#comments .image-uploader').css('display','block')});$('#notice-comment').on("click",function(){$('#comments .secret-comment-form').css('display','none');$('#comments #supporter-options').css('display','none')});$('#modal-general-comment').on("click",function(){$commentEditForm.find(".secret-comment-form").show();$commentEditForm.find("#supporter-options").hide();$('.modal .custom-checkbox').css('visibility','visible');$('.modal .image-uploader').css('display','none');$('.modal .info-message').css('display','none')});$('#modal-notice-comment').on("click",function(){$commentEditForm.find(".secret-comment-form").hide();$commentEditForm.find("#supporter-options").hide()});if($supportComment.prop("checked")){$('#comments .secret-comment-form').css('display','none');$('#comments #supporter-options').css('display','block')}
let commentLikeAvailable=!0;$("#responses").on("click",".btn-comment-like",function(e){e.preventDefault();commentLikeAvailable=!1;const $btn=$(this);const commentId=$btn.attr("data-comment-id");let $likeCount=$btn.find(".count, .like-count");let num=0;if($likeCount.length>0){num=parseInt($.trim($likeCount.text()));if(isNaN(num)){num=0}}else{$likeCount=$("<span class='like-count count'></span>");$btn.append($likeCount)}
if($btn.hasClass("active")){$btn.removeClass("active");num--}else{num++;$btn.addClass("active")}
if($likeCount.length>0){$btn.find(".count, .like-count").text(num);if(num===0){$likeCount.hide()}else{$likeCount.show()}}
$.ajax({url:postypeUrl+"/api/comment_like",type:"get",dataType:"jsonp",data:"comment_id="+commentId,success:function(json){if(json.status!=="success"){if(json.status==="no-permission"){const $easyLogin=$("#easy-login");if($easyLogin.length>0){$easyLogin.modal("show")}else{confirmPostype(json.message,function(){location.href=postypeUrl+"/login"})}}else{alertPostype(json.message)}
$btn.removeClass("active");num--;$btn.find(".count, .like-count").text(num);if(num===0){$likeCount.hide()}}},complete:function(){commentLikeAvailable=!0}});return!1});$commentForm.off("submit");$commentForm.submit(function(){const $submitButton=$commentForm.find("button.btn-submit");$submitButton.loading(!0);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(json){if(json.status==="success"){const key=json.data.key;$commentForm.find("input[name=session_key]").val(key);$commentForm.ajaxSubmit({type:"POST",dataType:'json',success:function(json){if(json.status==='success'){location.reload()}else if(json.status==="no-activation"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else if(json.status==="no-permission"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else{alertPostype(json.message)}},error:function(request,status,error){alertPostype("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error)},complete:function(){$submitButton.loading(!1)}})}}});return!1});$commentReplyForm.off("submit");$commentReplyForm.submit(function(){const $submitButton=$commentReplyForm.find("button.btn-primary");$submitButton.loading(!0);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(json){if(json.status==="success"){const key=json.data.key;$commentReplyForm.find("input[name=session_key]").val(key);$commentReplyForm.ajaxSubmit({type:"POST",dataType:'json',success:function(json){if(json.status==='success'){$commentReplyForm.modal("hide");let $parent=$("#comment-"+json.data.comment.sort1);if($parent.length>0){while(!0){const $next=$parent.next();if($next.length===0){$parent.after(json.data.html);break}else if(!$next.hasClass("reply")){$parent.after(json.data.html);break}
$parent=$next}}}else if(json.status==="no-activation"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else if(json.status==="no-permission"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else{alertPostype(json.message)}},error:function(request,status,error){alertPostype("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error)},complete:function(){$submitButton.loading(!1)}})}}});return!1});$commentEditForm.off("submit");$commentEditForm.submit(function(){const $submitButton=$commentEditForm.find("button.btn-primary");$submitButton.loading(!0);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(json){if(json.status==="success"){const key=json.data.key;$commentEditForm.find("input[name=session_key]").val(key);$commentEditForm.ajaxSubmit({type:"POST",dataType:'json',success:function(json){if(json.status==='success'){location.reload()}else if(json.status==="no-activation"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else if(json.status==="no-permission"){if(json.message){confirmPostype(json.message,function(){location.href=json.failure_return_url})}}else{alertPostype(json.message)}},error:function(request,status,error){alertPostype("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error)},complete:function(){$submitButton.loading(!1)}})}}});return!1});$(document).on("click",".btn-comment-reply",function(){const $btn=$(this);const $item=$btn.closest(".item");const sort1=$item.attr("data-sort1");const $commentHeader=$item.find(".comment-header");const $commentContent=$item.find(".comment-content");const $p=$commentContent.find("p");const text=$.trim($p.text());$commentReplyForm.find(".comment-header .author").text($commentHeader.find(".author").text());$commentReplyForm.find(".comment-header img").attr("src",$item.find("img.user-avatar").attr("src"));$commentReplyForm.find(".parent-comment").html(nl2br(text));$commentReplyForm.find("[name=parent_id]").val(sort1);const $replyFormImage=$("#reply-form-image");if($item.hasClass("use-image")){$replyFormImage.show();$commentReplyForm.find(".image-before").show();$commentReplyForm.find("input[name=file_id]").val("");$commentReplyForm.find("input[type=file]").val("");$commentReplyForm.find(".image-after").hide();$commentReplyForm.find(".image-uploading").hide()}else{$replyFormImage.hide()}
$commentReplyForm.find("textarea").val("");$commentReplyForm.modal("show")});const $commentEditSecret=$("#comment-edit-secret");$(document).on("click",".btn-comment-edit",function(event){event.preventDefault();const $btn=$(this);const $item=$btn.closest(".item");let isNotice=!1;let isReply=!1;let useImage=!1;if($item.hasClass("is-notice")){isNotice=!0}
if($item.hasClass("use-image")){useImage=!0}
if($item.hasClass("reply")){isReply=!0}
const $commentOptionWrapper=$("#comment-option-wrapper");const commentId=$item.attr("data-comment-id");const $commentContent=$item.find(".comment-content");const $p=$commentContent.find("p");let text=$.trim($p.text());const $secretCommentForm=$commentEditForm.find(".secret-comment-form");$commentEditForm.attr("action","/api/comment/"+commentId);$commentEditForm.find("textarea").val(text.replace(/(<br>|<br\/>|<br \/>)/g,'\r\n'));if($item.hasClass("is-secret")){$commentEditSecret.show();$commentEditForm.find("[name=is_secret]").attr("checked","checked")}else{$commentEditSecret.hide();$commentEditForm.find("[name=is_secret]").removeAttr("checked")}
if(useImage||isReply){$commentOptionWrapper.hide()}else{$commentOptionWrapper.show()}
const $commentEditFormImage=$("#comment-edit-form-image");if(useImage){$commentEditFormImage.show();$secretCommentForm.hide();const $commentImage=$item.find(".comment-image");if($commentImage.length>0){const $imageAfter=$commentEditForm.find(".image-after");$imageAfter.show();$imageAfter.find("img").attr("src",$commentImage.attr("src"));$commentEditForm.find("input[name=file_id]").val($commentImage.attr("data-file-id"));$commentEditForm.find(".image-before").hide();$commentEditForm.find("input[type=file]").val("");$commentEditForm.find(".image-uploading").hide()}else{$commentEditForm.find(".image-before").show();$commentEditForm.find("input[name=file_id]").val("");$commentEditForm.find("input[type=file]").val("");$commentEditForm.find(".image-after").hide();$commentEditForm.find(".image-uploading").hide()}}else{$secretCommentForm.show();$commentEditFormImage.hide();if(isNotice){$("#modal-notice-comment").prop("checked",!0);$secretCommentForm.hide()}else{$("#modal-notice-comment").prop("checked",!1);$secretCommentForm.show()}}
$commentEditForm.modal("show");return!1})}}
function initPostContent(postId){if($postContent.length===0){$postContent=$postBodyWrapper.find("#post-content")}
if(typeof setCodeComponents==="function"){setCodeComponents()}
if(postId!==undefined){if($(".mobile-app-webview").length===0){let checkDomain=window.location.hostname;const viewKey="view."+postId;let viewMode="visit";setTimeout(function(){const viewCookie=Cookies.get(viewKey);if(!viewCookie){const visitCookie=Cookies.get(visitKey);let referrer="";if(visitCookie){viewMode=""}else{referrer=document.referrer}
if(typeof referrer==="undefined"){referrer=""}
$.ajax({url:postypeUrl+"/api/post/view",type:"get",dataType:"jsonp",data:"blog_id="+blogId+"&post_id="+postId+"&mode="+viewMode+"&referrer="+encodeURIComponent(referrer),success:function(json){if(json.status==="success"){$body.attr("data-read-stats","1");Cookies.set(viewKey,!0,{expires:expires,path:"/",domain:checkDomain});if(viewMode==="visit"){Cookies.set(visitKey,!0,{expires:expires,path:"/",domain:checkDomain})}
const $number=$body.find(".view-count .number");let number=$number.text();number=number.replace(",","");if(/^(-\+)?([0-9]+|Infinity)$/.test(number)){number=Number(number)}else{number=NaN}
if(!isNaN(number)){number++;$number.text(number.format())}}}})}},2000);let isRead=!1;const readKey="read."+blogId+"."+postId;$(window).scroll(function(){const readStats=$body.attr("data-read-stats");if(readStats==="1"){const $elem=$postContent.find(">.pay");const docViewTop=$(window).scrollTop();const docViewBottom=docViewTop+$(window).height();const elemTop=$elem.offset().top;const elemBottom=elemTop+$elem.height();if((elemBottom<=docViewBottom)&&(elemTop>=docViewTop)){const readCookie=Cookies.get(readKey);if(!readCookie){Cookies.set(readKey,!0,{expires:1,path:'/',domain:checkDomain});if(isRead===!1){isRead=!0;$.ajax({url:postypeUrl+"/api/post/read",type:"get",dataType:"jsonp",data:"blog_id="+blogId+"&post_id="+postId,success:function(json){if(json.status==="success"){}}})}}}}})}
const $modalSupport=$("#modal-support");$(".btn-support").on("click",function(){if($modalSupport.length>0){$modalSupport.modal('show')}else{$("#easy-login").modal("show")}});const $modalPurchase=$("#modal-purchase");$(".btn-purchase").on("click",function(){if($modalPurchase.length>0){$modalPurchase.modal('show')}else{confirmPostype("로그인이 필요한 서비스입니다. 로그인 페이지로 이동하시겠습니까?",function(){location.href=postypeUrl+"/login"})}});$modalSupport.on("submit",function(){pay($modalSupport);return!1});$modalPurchase.on("submit",function(){pay($modalPurchase);return!1});const $supportLackPoint=$("#support-lack-point");const $supportOwnPoint=$("#support-own-point");const $supportRemainPoint=$("#support-remain-point");if(parseInt($supportOwnPoint.attr("data-value"))<100){$supportLackPoint.show()}else{$supportLackPoint.hide()}
$modalSupport.on("change keyup","input[name=point]",function(){let point=$(this).val();if(point===""){point=0}
let remainPoint=parseInt($supportOwnPoint.attr("data-value"))-parseInt(point);$supportRemainPoint.text(remainPoint.format());if(remainPoint>=0){$supportLackPoint.hide()}else{$supportLackPoint.show()}});$(".btn-reset-uploaded-image").on("click",function(){const $form=$(this).closest("form");$form.find(".image-before").show();$form.find("input[name=file_id]").val("");$form.find("input[name=file_delete]").val("1");$form.find(".image-after").hide();$form.find(".image-before").show()});$(".support-image").on("change",function(){const $formFile=$(this);const $form=$formFile.closest("form");const file=$formFile.get(0);let maxSize=10*1024*1024;let fileSize=file.files[0].size;if(fileSize>maxSize){alertPostype("사진은 10MB 이내로 등록 가능합니다.");if($("html").hasClass("ie")){$formFile.replaceWith($formFile.clone())}else{$formFile.val('')}
return}
const $imageBefore=$form.find(".image-before");const $imageUploading=$form.find(".image-uploading");const $imageAfter=$form.find(".image-after");$imageBefore.hide();$imageUploading.show();$form.ajaxSubmit({url:"/api/file/upload",dataType:'json',type:'post',success:function(json){if(json.status==="success"){$form.find("input[name=file_id]").val(json.data.file_id);const imageGifUrl=json.data.full_path;const imageThumbnailUrl=json.data.thumbnail;let imageSrc=imageGifUrl?imageGifUrl:imageThumbnailUrl;$imageAfter.find("img").attr("src",imageSrc);$imageUploading.hide();$imageAfter.show()}else if(json.status==="failure"){alertPostype(json.message);$imageBefore.show();$imageUploading.hide()}},complete:function(){if($("html").hasClass("ie")){$formFile.replaceWith($formFile.clone())}else{$formFile.val('')}}});return!1});const $episodes=$("#episodes");const $episodesOl=$episodes.find("ol.episode-list");const $btnLoadNext=$("#btn-load-next");const $btnLoadPrev=$("#btn-load-previous");$(".episodes-toggle").on("click",function(event){event.preventDefault();$body.toggleClass('episodes-show');const $backdrop=$body.find(">.backdrop");if($backdrop.length>0){$backdrop.remove()}else{if($episodesOl.find("li").length===0){getRelatedPosts(0)}
$body.append("<div class='backdrop fade'></div>")}
return!1});$btnLoadPrev.on("click",function(){const page=$(this).attr("data-page");getRelatedPosts(page)});$btnLoadNext.on("click",function(){const page=$(this).attr("data-page");getRelatedPosts(page)});function getRelatedPosts(page){$.ajax({url:postypeUrl+"/api/post/"+postId+"/related",type:'get',dataType:'jsonp',data:"page="+page,success:function(json){if(json.status==='success'){page=parseInt(page);if(page<=0){if(json.data.has_prev){$btnLoadNext.show();$btnLoadNext.attr("data-page",parseInt(page)-1)}else{$btnLoadNext.hide()}}
if(page>=0){if(json.data.has_next){$btnLoadPrev.show();$btnLoadPrev.attr("data-page",parseInt(page)+1)}else{$btnLoadPrev.hide()}}
let html="";$(json.data.htmls).each(function(i,val){html+=val});if(page<0){$episodesOl.prepend(html)}else{$episodesOl.append(html)}
$episodesOl.find(">li[data-post-id="+postId+"]").addClass("active btn-strong")}}})}
$("#episodes-close").on("click",function(event){event.preventDefault();$body.removeClass('episodes-show');$body.find(">.backdrop").remove();return!1});$header.on("click",".btn-delete",function(){const url=$body.attr("data-blog-url");if(postId){confirmPostype("포스트를 삭제하시겠습니까?",function(){$.ajax({url:postypeUrl+"/api/post/trash/"+postId,type:"get",dataType:"jsonp",success:function(json){if(json.status==='success'){location.href=url}else{alertPostype(json.message)}}})})}
return!1});$header.on("click",".btn-undo",function(){const url=$body.attr("data-blog-url");if(postId){confirmPostype("포스트를 발행 취소하시겠습니까? 발행 취소한 포스트는 [블로그 관리] > [포스트] > [임시저장글]로 이동합니다.",function(){$.ajax({url:postypeUrl+"/api/post/unpublish/"+postId,type:"get",dataType:"jsonp",success:function(json){if(json.status==='success'){location.href=url}else{alertPostype(json.message)}}})})}
return!1});function pay($form){const $submitButton=$form.find("button.btn-primary");$submitButton.loading(!0);$.ajax({url:postypeUrl+"/connector/getSessionKey",dataType:"jsonp",type:"GET",success:function(json){if(json.status==="success"){const key=json.data.key;$form.find("input[name=session_key]").val(key);$form.modal("hide");$form.ajaxSubmit({url:"/api/post/support",type:"post",dataType:'json',success:function(json){if(json.status==='success'){const type=json.data.type;const point=json.data.point;const postId=json.data.post_id;if(typeof fbq==="function"){let facebookType="PurchasePost";if(type==="support"){facebookType="SupportAuthor"}
fbq('trackCustom',facebookType,{value:point,currency:'KRW',contents:[{id:postId.format(),quantity:1}],content_type:'post'})}
if(typeof kakaoPixel==="function"){let kakaoType="PURCHASE_POST";if(type==="support"){kakaoType="SUPPORT_AUTHOR"}
kakaoPixel('4969140283302627999').purchase({tag:kakaoType,total_price:point.format(),currency:"KRW",products:[{name:postId.format(),quantity:"1",price:point.format()}]})}
if(typeof dataLayer!=="undefined"){let googleType="PURCHASE_POST";if(type==="support"){googleType="SUPPORT_AUTHOR"}
dataLayer.push({"user_agent":navigator.userAgent,"event":googleType,"amount":point,"post_id":postId})}
alertPostype(json.message,function(){location.reload()})}else if(json.status==='no-permission'){confirmPostype(json.message,function(){location.href=postypeUrl+"/login"})}else{alertPostype(json.message,function(){$form.modal("show")})}},error:function(request,status,error){alertPostype("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error)},complete:function(){$submitButton.loading(!1)}})}}})}}
clearPhotoset();resizePhotoset();resizeIframe();let originalWidth=$(window).width();$(window).resize(function(){let newWidth=$(window).width();if(originalWidth!==newWidth){resizePhotoset();resizeIframe();originalWidth=newWidth}});setAudioComponents();$postContent.find("a").each(function(i,val){const $a=$(val);if(!$a.hasClass("btn")){const target=$a.attr("target");if(typeof target=='undefined'){$a.attr("target","_blank")}}});$postContent.on("click",">.photoset div:not(.cloned) a.photo",function(event){event.preventDefault();const $this=$(this);const pswpElement=document.querySelectorAll('.pswp')[0];if(!pswpElement){return}
let items=[];let index=0;let num=0;$postContent.find(">.photoset div:not(.cloned) a.photo").each(function(i,val){const $val=$(val);if(!$val.parent().hasClass("cloned")){const caption=$val.attr("data-caption");const item={src:$val.attr("href"),w:$val.attr("data-width"),h:$val.attr("data-height"),title:caption};items.push(item);if($val.get(0)===$this.get(0)){index=num}
num++}});const options={history:!1,focus:!1,index:index,showAnimationDuration:0,shareButtons:{},loop:!1,};const gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init()});const $guideToolip=$("#guide-tooltip");const $btnCloseGuideTooltip=$("#btn-close-guide-tooltip");const guideTooltipKey='guideToolTipKey';const guideTooltipValue='guideToolTipKey1';$btnCloseGuideTooltip.on("click",function(){closeGuideTooltip()});function closeGuideTooltip(){Cookies.set(guideTooltipKey,'guideToolTipKey1',{expires:365,path:'/',domain:cookieDomain});$guideToolip.hide()}
const checkGuideTooltipValue=Cookies.get(guideTooltipKey);if(checkGuideTooltipValue!==guideTooltipValue){$guideToolip.show()}
const $btnToggleDropdown=$("#btn-toggle-dropdown");$btnToggleDropdown.on("click",function(){closeGuideTooltip()});const fontSizeLevels=['font-size-level1','font-size-level2','font-size-level3','font-size-level4','font-size-level5','font-size-level6'];const $btnBiggerFont=$("#btn-bigger-font");const $btnSmallerFont=$("#btn-smaller-font");const fontSizeLevelKey='defaultfontSize3';let fontSizeLevel=Cookies.get(fontSizeLevelKey);fontSizeLevel=parseInt(fontSizeLevel);if(isNaN(fontSizeLevel)){fontSizeLevel=3}
if(fontSizeLevel===1){$btnSmallerFont.attr("disabled","disabled")}
if(fontSizeLevel===5){$btnBiggerFont.attr("disabled","disabled")}
let fontSizeLevelClass=fontSizeLevels[fontSizeLevel-1];$postContent.addClass(fontSizeLevelClass);$btnBiggerFont.on("click",function(event,manualSize){manualSize=parseInt(manualSize);if(isNaN(manualSize)){manualSize=0}
if(manualSize>=1&&manualSize<=fontSizeLevels.length){fontSizeLevel=manualSize}else{manualSize=0}
if(fontSizeLevel<=fontSizeLevels.length){$postContent.removeClass(fontSizeLevelClass);if(!manualSize&&fontSizeLevel<fontSizeLevels.length){fontSizeLevel++}
fontSizeLevelClass=fontSizeLevels[fontSizeLevel-1];$postContent.addClass(fontSizeLevelClass);Cookies.set(fontSizeLevelKey,fontSizeLevel,{expires:365,path:'/',domain:cookieDomain});$guideToolip.hide();if(fontSizeLevel===5){$btnBiggerFont.attr("disabled","disabled")}else{$btnBiggerFont.removeAttr("disabled")}
$btnSmallerFont.removeAttr("disabled")}
return!1});$btnSmallerFont.on("click",function(event,manualSize){manualSize=parseInt(manualSize);if(isNaN(manualSize)){manualSize=0}
if(manualSize>=1&&manualSize<=fontSizeLevels.length){fontSizeLevel=manualSize}else{manualSize=0}
if(fontSizeLevel>=1){$postContent.removeClass(fontSizeLevelClass);if(!manualSize&&fontSizeLevel>1){fontSizeLevel--}
fontSizeLevelClass=fontSizeLevels[fontSizeLevel-1];$postContent.addClass(fontSizeLevelClass);Cookies.set(fontSizeLevelKey,fontSizeLevel,{expires:365,path:'/',domain:cookieDomain});$guideToolip.hide();if(fontSizeLevel===1){$btnSmallerFont.attr("disabled","disabled")}else{$btnSmallerFont.removeAttr("disabled")}
$btnBiggerFont.removeAttr("disabled")}
return!1});$postContent.addClass("visible")}
function initUI(){const $site=$("#blog");if(!$site.hasClass("header-is-thin")){const $gnb=$("#gnb");const $gnbNav=$("#gnb-nav");const $main=$("#main");const $masthead=$("#masthead");let headerHeight=$header.height();let gnbHeight=$gnb.height();let gnbNavHeight=$gnbNav.height();let defaultWidth=$(window).width();$(window).on("resize",function(){if($(window).width()!==defaultWidth){headerHeight=$header.height();gnbHeight=$gnb.height();gnbNavHeight=$gnbNav.height();setScroll()}});$(document).on("scroll",function(){setScroll()});function setScroll(){let scrollTop=$(document).scrollTop();let headerNavHeight=gnbHeight+gnbNavHeight;if(scrollTop>=(headerHeight-headerNavHeight)){if(!$site.hasClass("header-is-fixed")){$site.addClass("header-is-fixed");$main.css("margin-top",headerHeight);$headerCustom.css("margin-top",(headerHeight-headerNavHeight)*-1);$masthead.css("padding-top",headerHeight-headerNavHeight);$masthead.css("padding-bottom",gnbHeight)}}else{if($site.hasClass("header-is-fixed")){$site.removeClass("header-is-fixed");$main.css("margin-top","");$headerCustom.css("margin-top","");$masthead.css("padding-top","");$masthead.css("padding-bottom","")}}
let opacity=1-(Math.round(scrollTop*100/(gnbHeight))/100);$masthead.css({opacity:opacity})}}
if($site.hasClass("blog-post")){let prevScrollpos=window.pageYOffset;let startScrollpos=null;window.onscroll=function(){let currentScrollPos=window.pageYOffset;if(prevScrollpos>currentScrollPos||prevScrollpos===0){if(startScrollpos===null){startScrollpos=currentScrollPos}else{if(startScrollpos-70>=currentScrollPos||currentScrollPos<=70){$site.removeClass("scroll-down")}}}else{startScrollpos=null;if(currentScrollPos>=104){$site.addClass("scroll-down")}}
prevScrollpos=currentScrollPos}}
const $searchInput=$("#search-input");$("#search-toggle").on("click",function(event){event.preventDefault();$body.toggleClass('search-show');$searchInput.focus();return!1});$("#search-close").on("click",function(event){event.preventDefault();$body.removeClass('search-show');$searchInput.blur();return!1});const $search=$("#search");$searchInput.on("focus",function(){$search.addClass("focused")});if($searchInput.prop("autofocus")){$search.addClass("focused")}
$searchInput.on("blur",function(){$search.removeClass("focused")});const $categorySortForm=$("#category-sort-form");if($categorySortForm.length>0){$categorySortForm.find("select").on("change",function(){$categorySortForm.submit()})}
const $postListSortForm=$("#post-list-sort-form");if($postListSortForm.length>0){$postListSortForm.find("input[type=checkbox]").on("change",function(){$postListSortForm.submit()})}}});